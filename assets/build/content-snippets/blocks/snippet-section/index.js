(()=>{"use strict";const e=window.wp.blocks,t=JSON.parse('{"UU":"jp-content-snippets/snippet-section","DD":"Snippet Section","L1":"text","uK":{}}'),n=window.ReactJSXRuntime,o=window.wp.blockEditor,s=window.wp.components,i=window.wp.element;function c({label:e,isLoading:t,options:o,onSelect:c,value:r}){const[l,a]=(0,i.useState)(o);return(0,n.jsxs)("div",{className:"jp-blocks-combobox",children:[(0,n.jsx)(s.ComboboxControl,{label:t?"Fetching Options...":e,value:r,onChange:c,options:l,__experimentalRenderItem:({item:e})=>(0,n.jsx)("div",{className:"jp-blocks-combobox__item ",style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{style:{fontSize:"12px",fontWeight:"bold",margin:0},children:e.label}),e.subLabel&&(0,n.jsx)("p",{style:{fontSize:"10px",margin:0},children:e.subLabel})]})},e.value),onFilterValueChange:e=>{const t=o.filter((t=>e.length<2||t.label.toLowerCase().includes(e.toLowerCase())));a(t)}}),t&&(0,n.jsx)(s.Spinner,{style:{width:"calc(4px * 8)",height:"calc(4px * 8)"}})]})}const r=window.wp.data,l=(window.wp.coreData,"sfwd-lessons"),a="ld_lesson_category";function d({onSubmit:e}){var t;const[o,s]=(0,i.useState)(void 0),{terms:d,termsLoading:p}=(0,r.useSelect)((e=>{const t={per_page:-1};return{terms:e("core").getEntityRecords("taxonomy",a,t),termsLoading:e("core").isResolving("core","getEntityRecords",["taxonomy",a,t])}}),[]),{posts:b,postsLoading:g}=(0,r.useSelect)((e=>{const t={per_page:-1,post_type:l,_embed:!0};return{posts:e("core").getEntityRecords("postType",l,t),postsLoading:e("core").isResolving("core","getEntityRecords",["postType",l,t])}}),[]),m=g||p;return console.log(b),(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{children:"Select Lesson Form"}),(0,n.jsxs)("form",{onSubmit:t=>{t.preventDefault(),o&&e(o)},children:[(0,n.jsx)(c,{label:"Pick a Lesson to use it's content",isLoading:m,options:!m&&b?.length?b.map(u):[],value:null!==(t=o?.id.toString())&&void 0!==t?t:null,onSelect:e=>{if(e){const t=b?.find((t=>t.id.toString()===e));s(t)}}}),(0,n.jsx)("button",{type:"submit",className:"button button-small",children:"Submit"})]})]})}function u(e){const t={value:e.id.toString(),label:e.title.raw};if(e?._embedded["wp:term"]?.length){const n=e._embedded["wp:term"].map((e=>e.map((e=>e.name)).flat()));t.subLabel=n.filter(Boolean).join(", ")}return t}function p(e,t){const n=wp.data.select("core/block-editor").getBlock(e);if(n.name===t)return n;if(n.innerBlocks)for(const e of n.innerBlocks){const n=p(e.clientId,t);if(n)return n}}function b(e,t){wp.data.dispatch("core/block-editor").updateBlock(e,{attributes:{content:t}})}async function g(e){return await wp.apiFetch({path:"/jp/v1/lesson-video-url?id="+e}).then((e=>e.url)).catch((e=>(console.error(e),"")))}(0,e.registerBlockType)(t.UU,{attributes:t.uK,category:t.L1,title:t.DD,edit:function({clientId:e}){return(0,n.jsxs)("div",{...(0,o.useBlockProps)(),children:[(0,n.jsx)(o.InspectorControls,{children:(0,n.jsx)(s.PanelBody,{title:"Use Content From Lesson",initialOpen:!0,children:(0,n.jsx)(d,{onSubmit:t=>async function(e,t){const n=t.title.rendered.trim(),o=(t.excerpt?.raw||t.content?.raw.substring(0,10))?.trim(),s=function(e){return p(e,"core/heading")}(e);s&&n&&b(s.clientId,n);const i=function(e){return p(e,"core/paragraph")}(e);i&&o&&b(i.clientId,o);const c=function(e){return p(e,"core/button")}(e);c&&function(e,t){wp.data.dispatch("core/block-editor").updateBlock(e,{attributes:{url:t}})}(c.clientId,t.link);const r=function(e){return p(e,"core/image")}(e);if(r){const e=await g(t.id);if(!e)return;await async function(e,t){wp.data.dispatch("core/block-editor").updateBlock(e,{attributes:{url:t}})}(r.clientId,e)}else{const n=function(e){const t=wp.data.select("core/block-editor").getBlock(e)?.innerBlocks?.[0];return console.log(t),"core/group"!==t.name?void 0:(console.log(t.attributes.style.background.backgroundImage),t.attributes.style.background.backgroundImage?(console.log("found image"),t):void 0)}(e);if(n){const e=await g(t.id);if(console.log(e),!e)return;console.log("url",e),function(e,t,n){console.log("Updating image url",t),wp.data.dispatch("core/block-editor").updateBlock(e,{attributes:{...n.attributes,style:{...n.attributes.style,background:{...n.attributes.style.background,backgroundImage:{...n.attributes.style.background.backgroundImage,url:t}}}}})}(n.clientId,e,n)}}}(e,t)})})}),(0,n.jsx)(o.InnerBlocks,{})]})},save:function(){return(0,n.jsx)("div",{...o.useBlockProps.save(),children:(0,n.jsx)(o.InnerBlocks.Content,{})})}})})();